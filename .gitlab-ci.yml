# Variables définies dans GitLab : Settings → CI/CD → Variables (pas dans ce fichier)

stages:
  - build
  - push

build-backend:
  stage: build
  image: docker:24
  services:
    - docker:24-dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - docker build
        -t $BACKEND_IMAGE
        -f backend/Dockerfile
        backend/
  after_script:
    - docker push $BACKEND_IMAGE

build-frontend:
  stage: build
  image: docker:24
  services:
    - docker:24-dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - docker build
        --build-arg VITE_API_URL=${VITE_API_URL:-http://localhost:8000}
        -t $FRONTEND_IMAGE
        -f frontend/ticket-frontend/Dockerfile
        frontend/ticket-frontend/
  after_script:
    - docker push $FRONTEND_IMAGE
